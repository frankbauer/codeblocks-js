<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="codeblocks-baseurl" content="<%= BASE_URL %>">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>frontend</title>
    <link rel=stylesheet href="<%= BASE_URL %>css/loader.css">     
    <link rel=stylesheet href="<%= BASE_URL %>css/roboto.css">  
    <link rel=stylesheet href="<%= BASE_URL %>css/main.css">  
    <script src="<%= BASE_URL %>js/jquery.min.js" type="text/javascript"></script>
    <style>
      codeblockseditor > *,  codeblocks > *, [codeblockseditor] > *,  [codeblocks] > *{
				display:none;        
      }
    </style>
  </head>
  <body>
      
    <noscript>
      <strong>We're sorry but this doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div codeblockseditor data-compiler="java" data-compiler-version="101" data-run-code="true" data-max-characters="10000000" data-execution-timeout="50000" data-message-passing=1 data-persistent-arguments=1 data-keep-alive=1>
        <loading><div></div><div></div></loading> 
        
        <block data-visible-lines="auto" data-expanded=0>import org.lgdv.*;

public class One{    
    public static void main(String[] args){
        System.out.println("START " + args[0]);
        args[0] = "Test";
        CodeBlocks.startReceivingEvents((CodeBlocksBaseMessage request) -> {
            System.out.println("Hello" + request.getCommand());       
            
            CodeBlocks.postMessage("echo", request.getId());
            if (request.getCommand().equals("nonce")) {                
                System.exit(0);
            }
        });
        int[] a = {1, 2, 3};
        System.out.println("ENDE" + a[0]);
        System.err.println("ERR");
    }
}</block>

<playground>{
    runner:null,
    init: function(canvasElement, outputElement, scope, runner) {
        canvasElement.hide();
        this.runner = runner
        runner.postMessage('from-init', {})        
    },
    addArgumentsTo(args) {
        console.log("Input State", args)
        args.push("Hello");        
    },
    reset(canvasElement) {},
    onMessage(cmd, data) {   
        console.log("Message", cmd, data)     
    },
    beforeStart() {        
        console.log("Starting")
        setTimeout(() => { this.runner.postMessage('nonce', {})}, 2000)
    },
    whenFinished(args){
        console.log("Finished", args)
    },
    update: function(txt, json, canvasElement, outputElement) {

    }
}</playground>
    </div>
    <div style="padding-left:50px;padding-right:50px">
      <div codeblockseditor data-compiler="javascript" data-compiler-version=102 data-run-code="true" data-max-characters="10000000" data-dom-libs='["phaser-3.54"]'>
        <loading><div></div><div></div></loading> 
        
        <block data-visible-lines="auto" data-expanded=0>
            console.log("IN ARGS", args)
            args.t = "Foo"
            args.ct++
            CodeBlocks.startReceivingEvents((request) => {
                console.log("Hello", request.command);       
                
                CodeBlocks.postMessage("echo", request.id);
                if (request.command == "nonce") {                
                    System.exit(0);
                }
            });
        </block>                   
        
        <playground>{ 
            scope:undefined,
            init: function(canvasElement, outputElement, scope, runner) {
                
                console.log("init")
                const self = this
                this.scope = scope
                

                var config = {
                    type: Phaser.AUTO,
                    backgroundColor: '#fdfdfd',
                    scale: {
                        parent: canvasElement[0],
                        mode: Phaser.Scale.NONE,
                        width: canvasElement.width(),
                        height: canvasElement.height(),
                        zoom: 1
                    },
                    scene: {
                        preload: preload,
                        create: create,
                        update: update
                    }
                };
                
                //var game = new Phaser.Game(config);
                var game = new Game(canvasElement, '#fdfdfd')
                game.addImage('tile', 'resources/tile/checker.png')
                game.addSpriteSheet('figure', 'resources/sprite/figure_blue_big.png', {
                    frameWidth: 76,
                    frameHeight: 64,
                }, true)
                game.addSpriteSheet('small', 'resources/sprite/figure_blue.png', {
                    frameWidth: 38,
                    frameHeight: 32,
                }, true)
                game.useIsometricMap(0, 0, 4, 3, 'tile')

                game.onCreate = (scene, game) => {
                    console.log("[PHASER] custom create")
                    const f1 = game.addWalkingSprite(190, 84, 'figure', 0)
                    const f2 = game.addWalkingSprite(280, 84, 'figure', 0)

                    f2.walkTo(280-3*45, 84+3*26)
                    f1.walkTo(280, 84)
                }
                
                game.start(false)

                function resize() {
                    let w = canvasElement.width();
                    let h = canvasElement.height();
                    // manually resize the game with the Phaser 3.16 scalemanager
                    this.scale.resize(w, h);
                    // Check which scene is active.
                    for (let scene of this.scene.manager.scenes) {
                        if (scene.scene.settings.active) {
                            // Scale the camera
                            scene.cameras.main.setViewport(0, 0, w, h);
                            if (scene.resizeField) {
                                // Scale/position stuff in the scene itself with this method, that the scene must implement.
                                scene.resizeField(w, h);
                            }
                        }
                    }
                }
                //window.addEventListener('resize', resize.bind(this));
                
                function preload ()
                {
                    this.load.image('tile', 'resources/tile/checker.png')
                    this.load.spritesheet('figure', 'resources/sprite/figure_blue_big.png',
                    {frameWidth:76, frameHeight:64});
                    this.load.spritesheet('small', 'resources/sprite/figure_blue.png',
                    {frameWidth:38, frameHeight:32});
                }

                let f1 = null;
                let f2 = null;
                
               
                function create ()
                {
                    this.cameras.main.setRoundPixels(true);

                    this.add.image(100, 100, 'tile')
                    this.add.image(190, 100, 'tile')
                    this.add.image(280, 100, 'tile')
                    this.add.image(145, 126, 'tile')
                    this.add.image(235, 126, 'tile')
                    this.add.image(100, 152, 'tile')
                    this.add.image(190, 152, 'tile')
                    this.add.image(280, 152, 'tile')
                    this.add.image(145, 178, 'tile')
                    this.add.image(235, 178, 'tile')

                    const oy = 36/64;
                    const ox = 37/76;
                    f1 = WalkingSprite.add(this, 190, 84, 'figure', 0)
                    f1.moveTo(ox, oy)
                    this.add.sprite(100, 84, 'small', 0).setOrigin(ox, oy)            
                    
                    f2 = WalkingSprite.add(this, 280, 84, 'figure', 0)
                    f2.moveTo(ox, oy)

                    animNamesByDir.forEach((name, nr) => {
                        const idx = sheetIndex[nr];
                        const conf = { start: idx*20, end: idx*20 + 19 };
                        console.log('ADD', name, conf)
                        this.anims.create({
                            key: 'figure-'+name,
                            frames: this.anims.generateFrameNumbers('figure', conf),
                            frameRate: 25,
                            repeat: -1
                        });
                    })                    
                    

                    
                    f2.sprite.anims.play('figure-O')
                    f1.sprite.anims.play('figure-S')
                    f2.walkTo(280-3*45, 84+3*26)
                    f1.walkTo(280, 84)
                }
                
                
                
                function update (time, delta)
                {
                    f1.update(time, delta)
                    f2.update(time, delta)
                    
                }                
            },
            addArgumentsTo(args) {        
            },
            update: function(txt, json, canvasElement, outputElement) {
                this.output = this.scope.find('#out')
                this.output.html(this.output.html() + "&lt;br>Hello")
                
                console.log("outputElement", outputElement)
                console.log("this.output", this.output)
                console.log("html", this.output.html())
                            
                return txt + "\n\nResult:"
            }
        }</playground>
        
        
        </div>
  </div>



</div>

    
  </div>
  <script>
      
</script>
    <!-- built files will be auto injected -->
    
  </body>
</html>
