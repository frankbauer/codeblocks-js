<!DOCTYPE html>
<html lang="de">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <meta name="codeblocks-baseurl" content="<%= BASE_URL %>">
        <link rel="icon" href="<%= BASE_URL %>favicon.ico">
        <title>frontend</title>
        <link rel=stylesheet href="<%= BASE_URL %>css/loader.css">
        <link rel=stylesheet href="<%= BASE_URL %>css/roboto.css">
        <link rel=stylesheet href="<%= BASE_URL %>css/main.css">
        <script src="<%= BASE_URL %>js/jquery.min.js" type="text/javascript"></script>
        <style>
            codeblockseditor>*,
            codeblocks>*,
            [codeblockseditor]>*,
            [codeblocks]>* {
                display: none;
            }
        </style>
    </head>

    <body>
        <noscript>
            <strong>We're sorry but this doesn't work properly without JavaScript enabled. Please enable it to
                continue.</strong>
        </noscript>
        
        <div codeblockseditor data-compiler="javascript" data-compiler-version="101" data-run-code="true"
            data-max-characters="10000000" data-execution-timeout="50000" data-message-passing=1
            data-persistent-arguments=1 data-keep-alive=1>
            <loading>
                <div></div>
                <div></div>
            </loading>

            <block data-visible-lines="auto" data-expanded=0>import org.lgdv.*;

                public class One{
                public static void main(String[] args){
                System.out.println("START " + args[0]);
                args[0] = "Test";
                CodeBlocks.startReceivingEvents((CodeBlocksBaseMessage request) -> {
                System.out.println("Hello" + request.getCommand());

                CodeBlocks.postMessage("echo", request.getId());
                if (request.getCommand().equals("nonce")) {
                System.exit(0);
                }
                });
                int[] a = {1, 2, 3};
                System.out.println("ENDE" + a[0]);
                System.err.println("ERR");
                }
                }</block>

            <script as="playground" type="application/javascript">
exports = {
    runner: null,
    init: function (canvasElement, outputElement, scope, runner) {
        canvasElement.hide();
        this.runner = runner
        runner.postMessage('from-init', {})
    },
    addArgumentsTo(args) {
        console.log("Input State", args)
        args[0] = "Hello";
    },
    reset(canvasElement) {},
    onMessage(cmd, data) {
        console.log("Message", cmd, data)
    },
    beforeStart() {
        console.log("Starting")
        setTimeout(() => {
            this.runner.postMessage('nonce', {})
        }, 2000)
    },
    whenFinished(args) {
        console.log("Finished", args)
    },
    update: function (txt, json, canvasElement, outputElement) {

    }
}
            </script>
        </div>
        <div style="padding-left:50px;padding-right:50px">
            <div codeblockseditor data-compiler="java" data-compiler-version=101 data-run-code="true"
            data-execution-timeout="50000" data-dom-libs='["phaser-3.54"]' data-message-passing=1
            data-persistent-arguments=1 data-keep-alive=1>
                <loading>
                    <div></div>
                    <div></div>
                </loading>

                <block data-visible-lines="auto" data-expanded=0>import org.lgdv.*;
import org.teavm.jso.JSObject;
import org.teavm.jso.JSProperty;

interface CodeBlocksClickMessage extends CodeBlocksBaseMessage {
    @JSProperty
    int getC();

    @JSProperty
    void setC(int value);
    
    @JSProperty
    int getR();

    @JSProperty
    void setR(int value);
}

public class One{
    public static void main(String[] args){
        System.out.println("BEGIN" + args.length);
        CodeBlocks.startReceivingEvents((CodeBlocksBaseMessage request) -> {
            System.out.println("Hello" + request.getCommand());
            
            if (request.getCommand().equals("click")){
                CodeBlocksClickMessage m = request.cast();
                System.out.println(m.getC() + "/" + m.getR());

                CodeBlocksClickMessage reply = CodeBlocks.createJSObject();
                reply.setCommand("walk");
                reply.setC(m.getC());
                reply.setR(m.getR());
                CodeBlocks.postMessage(reply);
                return;                
            }
            CodeBlocks.postMessage("echo", request.getId());
            if (request.getCommand().equals("nonce")) {
                System.out.println("SHUTDOWN");
                System.exit(0);
            }
        });
        System.out.println("ENDE");
    }
}                                    
                </block>

                <script as="playground" type="application/javascript">
exports = new IsometricMapGame(4, 3, Tiles.Checkers, [Figures.BigGrinch, Figures.Blue], '#fdfdfd', (game, manager, canvasElement, outputElement, scope, runner)=>{
    game.addSpriteSheetConfig(`fire`, Sprites.Fire[0])
    manager.onPreload = () => {
        
    }
    manager.onCreate = () => {
        manager.figures[0].moveToTile(2, 1)
        manager.figures[1].moveToTile(3, 2)

        const f = game.addAnimatedSpriteOnTile(0, 0, "fire", 1)
        f.onFinishedAnimation = ()=> {
            console.log("REMOVING")
            f.remove()
        }
        f.play()
    }

    manager.onClick = (tile) => {
        //manager.figures[0].walkToTile(tile.column, tile.row)
        runner.postMessage('click', {c:tile.column, r:tile.row})
    }

    manager.onMessage = (cmd, data) => {
        if (cmd === 'walk') {
            manager.figures[0].walkToTile(data.c, data.r)
        } else {
            console.log(cmd + " - " + data)
        }
    }
})


                </script>


            </div>
        </div>



        </div>


        </div>
        <script>

        </script>
        <!-- built files will be auto injected -->

    </body>

</html>